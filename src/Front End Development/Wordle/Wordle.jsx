import list4 from "./fourLetter";
import list5 from "./fiveLetter";
import list6 from "./sixLetter";
import React from "react";
import "./Wordle.css";
import Keyboard from "./Keyboard";

const FourLetters = () => {
  return (
    <React.Fragment>
      <div class="tile-section">
        <input id="i0" type="text" class="fourInput wordleTile" />
        <input id="i1" type="text" class="fourInput wordleTile" />
        <input id="i2" type="text" class="fourInput wordleTile" />
        <input id="i3" type="text" class="fourInput wordleTile" />
      </div>
      <div class="tile-section">
        <input id="i4" type="text" class="fourInput wordleTile" />
        <input id="i5" type="text" class="fourInput wordleTile" />
        <input id="i6" type="text" class="fourInput wordleTile" />
        <input id="i7" type="text" class="fourInput wordleTile" />
      </div>
      <div class="tile-section">
        <input id="i8" type="text" class="fourInput wordleTile" />
        <input id="i9" type="text" class="fourInput wordleTile" />
        <input id="i10" type="text" class="fourInput wordleTile" />
        <input id="i11" type="text" class="fourInput wordleTile" />
      </div>
      <div class="tile-section">
        <input id="i12" type="text" class="fourInput wordleTile" />
        <input id="i13" type="text" class="fourInput wordleTile" />
        <input id="i14" type="text" class="fourInput wordleTile" />
        <input id="i15" type="text" class="fourInput wordleTile" />
      </div>
      <div class="tile-section">
        <input id="i16" type="text" class="fourInput wordleTile" />
        <input id="i17" type="text" class="fourInput wordleTile" />
        <input id="i18" type="text" class="fourInput wordleTile" />
        <input id="i19" type="text" class="fourInput wordleTile" />
      </div>
      <div class="tile-section">
        <input id="i20" type="text" class="fourInput wordleTile" />
        <input id="i21" type="text" class="fourInput wordleTile" />
        <input id="i22" type="text" class="fourInput wordleTile" />
        <input id="i23" type="text" class="fourInput wordleTile" />
      </div>
    </React.Fragment>
  );
};

const FiveLetters = () => {
  return (
    <React.Fragment>
      <div class="tile-section">
        <input id="i0" type="text" class="fiveInput wordleTile" />
        <input id="i1" type="text" class="fiveInput wordleTile" />
        <input id="i2" type="text" class="fiveInput wordleTile" />
        <input id="i3" type="text" class="fiveInput wordleTile" />
        <input id="i4" type="text" class="fiveInput wordleTile" />
      </div>
      <div class="tile-section">
        <input id="i5" type="text" class="fiveInput wordleTile" />
        <input id="i6" type="text" class="fiveInput wordleTile" />
        <input id="i7" type="text" class="fiveInput wordleTile" />
        <input id="i8" type="text" class="fiveInput wordleTile" />
        <input id="i9" type="text" class="fiveInput wordleTile" />
      </div>
      <div class="tile-section">
        <input id="i10" type="text" class="fiveInput wordleTile" />
        <input id="i11" type="text" class="fiveInput wordleTile" />
        <input id="i12" type="text" class="fiveInput wordleTile" />
        <input id="i13" type="text" class="fiveInput wordleTile" />
        <input id="i14" type="text" class="fiveInput wordleTile" />
      </div>
      <div class="tile-section">
        <input id="i15" type="text" class="fiveInput wordleTile" />
        <input id="i16" type="text" class="fiveInput wordleTile" />
        <input id="i17" type="text" class="fiveInput wordleTile" />
        <input id="i18" type="text" class="fiveInput wordleTile" />
        <input id="i19" type="text" class="fiveInput wordleTile" />
      </div>
      <div class="tile-section">
        <input id="i20" type="text" class="fiveInput wordleTile" />
        <input id="i21" type="text" class="fiveInput wordleTile" />
        <input id="i22" type="text" class="fiveInput wordleTile" />
        <input id="i23" type="text" class="fiveInput wordleTile" />
        <input id="i24" type="text" class="fiveInput wordleTile" />
      </div>
      <div class="tile-section">
        <input id="i25" type="text" class="fiveInput wordleTile" />
        <input id="i26" type="text" class="fiveInput wordleTile" />
        <input id="i27" type="text" class="fiveInput wordleTile" />
        <input id="i28" type="text" class="fiveInput wordleTile" />
        <input id="i29" type="text" class="fiveInput wordleTile" />
      </div>
    </React.Fragment>
  );
};

const SixLetters = () => {
  return (
    <React.Fragment>
      <div class="tile-section">
        <input id="i0" type="text" class="sixInput wordleTile" />
        <input id="i1" type="text" class="sixInput wordleTile" />
        <input id="i2" type="text" class="sixInput wordleTile" />
        <input id="i3" type="text" class="sixInput wordleTile" />
        <input id="i4" type="text" class="sixInput wordleTile" />
        <input id="i5" type="text" class="sixInput wordleTile" />
      </div>
      <div class="tile-section">
        <input id="i6" type="text" class="sixInput wordleTile" />
        <input id="i7" type="text" class="sixInput wordleTile" />
        <input id="i8" type="text" class="sixInput wordleTile" />
        <input id="i9" type="text" class="sixInput wordleTile" />
        <input id="i10" type="text" class="sixInput wordleTile" />
        <input id="i11" type="text" class="sixInput wordleTile" />
      </div>
      <div class="tile-section">
        <input id="i12" type="text" class="sixInput wordleTile" />
        <input id="i13" type="text" class="sixInput wordleTile" />
        <input id="i14" type="text" class="sixInput wordleTile" />
        <input id="i15" type="text" class="sixInput wordleTile" />
        <input id="i16" type="text" class="sixInput wordleTile" />
        <input id="i17" type="text" class="sixInput wordleTile" />
      </div>
      <div class="tile-section">
        <input id="i18" type="text" class="sixInput wordleTile" />
        <input id="i19" type="text" class="sixInput wordleTile" />
        <input id="i20" type="text" class="sixInput wordleTile" />
        <input id="i21" type="text" class="sixInput wordleTile" />
        <input id="i22" type="text" class="sixInput wordleTile" />
        <input id="i23" type="text" class="sixInput wordleTile" />
      </div>
      <div class="tile-section">
        <input id="i24" type="text" class="sixInput wordleTile" />
        <input id="i25" type="text" class="sixInput wordleTile" />
        <input id="i26" type="text" class="sixInput wordleTile" />
        <input id="i27" type="text" class="sixInput wordleTile" />
        <input id="i28" type="text" class="sixInput wordleTile" />
        <input id="i29" type="text" class="sixInput wordleTile" />
      </div>
      <div class="tile-section">
        <input id="i30" type="text" class="sixInput wordleTile" />
        <input id="i31" type="text" class="sixInput wordleTile" />
        <input id="i32" type="text" class="sixInput wordleTile" />
        <input id="i33" type="text" class="sixInput wordleTile" />
        <input id="i34" type="text" class="sixInput wordleTile" />
        <input id="i35" type="text" class="sixInput wordleTile" />
      </div>
    </React.Fragment>
  );
};

const Wordle = () => {
  const [letterCount, setLetterCount] = React.useState(null);
  const [letterChosen, setLetterChosen] = React.useState(false);
  const [currentWord, setCurrentWord] = React.useState(null);
  const [success, SetSuccess] = React.useState(null);
  const [tileIndex, setTileIndex] = React.useState(0);
  const [currentRow, setCurrentRow] = React.useState(1);
  const [mainObj, setMainObj] = React.useState({});
  const [keyboardGreenSet, setKeyboardGreenSet] = React.useState(new Set());

  // const [currentCorrect, setCurrentCorrect] = React.useState(0);

  const handleCreateObj = (word, range) => {
    const tempObj = {};
    for (let i = 0; i < word.length; i++) {
      const letter = word[i];
      if (!(letter in tempObj)) {
        tempObj[letter] = new Set();
      }
      tempObj[letter].add(range[i]);
    }
    return tempObj;
  };

  const handleReset = () => {
    setLetterCount((p) => null);
    setLetterChosen((p) => false);
    setCurrentWord((p) => null);
    SetSuccess((p) => null);
    setTileIndex((p) => 0);
    setCurrentRow((p) => 1);
    setMainObj((p) => {});
    setKeyboardGreenSet((p) => new Set());
  };

  const handleFinished = (status) => {
    SetSuccess((p) => status);
  };

  const handleWordLength = (wordLength) => {
    setLetterCount((p) => wordLength);
    handleWord(wordLength);
    setLetterChosen((p) => true);
  };

  const handleWord = (wordLength) => {
    if (wordLength == 4) {
      const randomIndex = Math.floor(Math.random() * list4.length);
      const randomWord = list4[randomIndex].word.toUpperCase();
      setMainObj((p) => handleCreateObj(randomWord, [...Array(4).keys()]));
      setCurrentWord((p) => randomWord);
    } else if (wordLength == 5) {
      const randomIndex = Math.floor(Math.random() * list5.length);
      const randomWord = list5[randomIndex].word.toUpperCase();
      setMainObj((p) => handleCreateObj(randomWord, [...Array(5).keys()]));
      setCurrentWord((p) => randomWord);
    } else {
      const randomIndex = Math.floor(Math.random() * list6.length);
      const randomWord = list6[randomIndex].word.toUpperCase();
      setMainObj((p) => handleCreateObj(randomWord, [...Array(6).keys()]));
      setCurrentWord((p) => randomWord);
    }
  };

  const checkWord = () => {
    if (tileIndex == currentRow * letterCount) {
      // setCurrentCorrect((p) => 0);
      const currentCorrect = handleColors();
      if (currentCorrect == letterCount) {
        return handleFinished(true);
      }
      setCurrentRow((prevRow) => {
        const nextRow = prevRow + 1;
        if (nextRow == 7) {
          return handleFinished(false);
        }
        return nextRow;
      });
    }
  };

  const handleColors = () => {
    let count = 0;

    // Step 1: Gather Row Tiles And Create Guess Object
    const NodeList = document.querySelectorAll("input");
    const matches = [].slice
      .call(NodeList)
      .slice((currentRow - 1) * letterCount, letterCount * currentRow);

    let guessWord = "";
    for (let match of matches) {
      guessWord += match.value;
    }
    const guessRange = [...Array(letterCount * currentRow).keys()].slice(
      (currentRow - 1) * letterCount,
      letterCount * currentRow
    );
    const guessObj = handleCreateObj(guessWord, guessRange);

    // Step 2: Create Objects To Correctly Identify Tile Color
    const greenObj = {};
    const yellowObj = {};
    for (let letter in guessObj) {
      if (letter in mainObj) {
        guessObj[letter].forEach((index) => {
          if (mainObj[letter].has(index % letterCount)) {
            if (!(letter in greenObj)) greenObj[letter] = new Set();
            greenObj[letter].add(index);
          } else {
            if (!(letter in yellowObj)) yellowObj[letter] = new Set();
            yellowObj[letter].add(index);
          }
        });
      } else {
        document.querySelector(`#${letter}`).classList.remove("gray-key");
        document.querySelector(`#${letter}`).classList.add("dark-key");
      }
    }

    // Step 3: Set Tile Colors Green then Yellow
    // I Only Care About the localCompletedSet To Check
    // Whether or not to add yellows
    const localGreenKeyboardSet = new Set();
    const localCompletedSet = new Set();
    for (let letter in greenObj) {
      localGreenKeyboardSet.add(letter);

      if (mainObj[letter].size == greenObj[letter].size)
        localCompletedSet.add(letter);

      greenObj[letter].forEach((index) => {
        count++;
        document.querySelector(`#i${index}`).classList.add("green");
      });
    }
    for (let letter in yellowObj) {
      if (localCompletedSet.has(letter)) continue;
      const yellowIterator = yellowObj[letter].values();
      const index = yellowIterator.next().value;
      document.querySelector(`#i${index}`).classList.add("yellow");
    }

    // Step 4: Set KeyBoard
    localGreenKeyboardSet.forEach((letter) => {
      if (!keyboardGreenSet.has(letter)) {
        document.querySelector(`#${letter}`).classList.remove("gray-key");
        document.querySelector(`#${letter}`).classList.remove("yellow-key");
        document.querySelector(`#${letter}`).classList.add("green-key");
      }
    });

    for (let letter in yellowObj) {
      if (localGreenKeyboardSet.has(letter) || keyboardGreenSet.has(letter)) {
        document.querySelector(`#${letter}`).classList.remove("yellow-key");
      } else {
        document.querySelector(`#${letter}`).classList.remove("gray-key");
        document.querySelector(`#${letter}`).classList.add("yellow-key");
      }
    }

    // Step 5: Set Global Green And Return Count

    setKeyboardGreenSet((prevGreenSet) => {
      localCompletedSet.forEach((letter) => {
        if (!prevGreenSet.has(letter)) prevGreenSet.add(letter);
      });
      return prevGreenSet;
    });

    return count;
  };

  const addLetter = (e) => {
    const id = e.target.id;
    if (tileIndex >= letterCount * currentRow) return;
    const tile = document.querySelector(`#i${tileIndex}`);
    tile.value = id;
    setTileIndex((p) => {
      return p + 1;
    });
  };

  const removeLetter = () => {
    if (tileIndex - 1 < (currentRow - 1) * letterCount) return;
    setTileIndex((p) => {
      const tile = document.querySelector(`#i${p - 1}`);
      tile.value = "";
      return p - 1;
    });
  };
  if (success !== null) {
    return (
      <main className="wordle-container">
        <h1>{success ? "You Won!" : "You Lost!"}</h1>
        <h2>The Word Was {currentWord}</h2>
        <button className="btn btn-outline-light" onClick={() => handleReset()}>
          Play Again!
        </button>
      </main>
    );
  }

  if (!letterChosen) {
    return (
      <main className="wordle-container">
        <h2 className="wordleMargin">How Many Letters for the Wordle?</h2>
        <div className="wordleLetterCount">
          <button
            class="btn btn-secondary "
            onClick={() => handleWordLength(4)}
          >
            4
          </button>
          <button class="btn btn-secondary" onClick={() => handleWordLength(5)}>
            5
          </button>
          <button class="btn btn-secondary" onClick={() => handleWordLength(6)}>
            6
          </button>
        </div>
      </main>
    );
  }
  return (
    <main className="wordle-container">
      <div class="tile-container">
        {letterCount == 4 ? (
          <FourLetters />
        ) : letterCount == 5 ? (
          <FiveLetters />
        ) : (
          <SixLetters />
        )}
      </div>
      <Keyboard
        addLetter={addLetter}
        removeLetter={removeLetter}
        checkWord={checkWord}
      />
    </main>
  );
};

export default Wordle;
