import list4 from "./fourLetter";
import list5 from "./fiveLetter";
import list6 from "./sixLetter";
import React from "react";
import "./Wordle.css";
import Keyboard from "./Keyboard";

const FourLetters = () => {
  return (
    <React.Fragment>
      <div class="tile-section">
        <input id="i0" type="text" class="fourInput wordleTile" disabled />
        <input id="i1" type="text" class="fourInput wordleTile" disabled />
        <input id="i2" type="text" class="fourInput wordleTile" disabled />
        <input id="i3" type="text" class="fourInput wordleTile" disabled />
      </div>
      <div class="tile-section">
        <input id="i4" type="text" class="fourInput wordleTile" disabled />
        <input id="i5" type="text" class="fourInput wordleTile" disabled />
        <input id="i6" type="text" class="fourInput wordleTile" disabled />
        <input id="i7" type="text" class="fourInput wordleTile" disabled />
      </div>
      <div class="tile-section">
        <input id="i8" type="text" class="fourInput wordleTile" disabled />
        <input id="i9" type="text" class="fourInput wordleTile" disabled />
        <input id="i10" type="text" class="fourInput wordleTile" disabled />
        <input id="i11" type="text" class="fourInput wordleTile" disabled />
      </div>
      <div class="tile-section">
        <input id="i12" type="text" class="fourInput wordleTile" disabled />
        <input id="i13" type="text" class="fourInput wordleTile" disabled />
        <input id="i14" type="text" class="fourInput wordleTile" disabled />
        <input id="i15" type="text" class="fourInput wordleTile" disabled />
      </div>
      <div class="tile-section">
        <input id="i16" type="text" class="fourInput wordleTile" disabled />
        <input id="i17" type="text" class="fourInput wordleTile" disabled />
        <input id="i18" type="text" class="fourInput wordleTile" disabled />
        <input id="i19" type="text" class="fourInput wordleTile" disabled />
      </div>
      <div class="tile-section">
        <input id="i20" type="text" class="fourInput wordleTile" disabled />
        <input id="i21" type="text" class="fourInput wordleTile" disabled />
        <input id="i22" type="text" class="fourInput wordleTile" disabled />
        <input id="i23" type="text" class="fourInput wordleTile" disabled />
      </div>
    </React.Fragment>
  );
};

const FiveLetters = () => {
  return (
    <React.Fragment>
      <div class="tile-section">
        <input id="i0" type="text" class="fiveInput wordleTile" disabled />
        <input id="i1" type="text" class="fiveInput wordleTile" disabled />
        <input id="i2" type="text" class="fiveInput wordleTile" disabled />
        <input id="i3" type="text" class="fiveInput wordleTile" disabled />
        <input id="i4" type="text" class="fiveInput wordleTile" disabled />
      </div>
      <div class="tile-section">
        <input id="i5" type="text" class="fiveInput wordleTile" disabled />
        <input id="i6" type="text" class="fiveInput wordleTile" disabled />
        <input id="i7" type="text" class="fiveInput wordleTile" disabled />
        <input id="i8" type="text" class="fiveInput wordleTile" disabled />
        <input id="i9" type="text" class="fiveInput wordleTile" disabled />
      </div>
      <div class="tile-section">
        <input id="i10" type="text" class="fiveInput wordleTile" disabled />
        <input id="i11" type="text" class="fiveInput wordleTile" disabled />
        <input id="i12" type="text" class="fiveInput wordleTile" disabled />
        <input id="i13" type="text" class="fiveInput wordleTile" disabled />
        <input id="i14" type="text" class="fiveInput wordleTile" disabled />
      </div>
      <div class="tile-section">
        <input id="i15" type="text" class="fiveInput wordleTile" disabled />
        <input id="i16" type="text" class="fiveInput wordleTile" disabled />
        <input id="i17" type="text" class="fiveInput wordleTile" disabled />
        <input id="i18" type="text" class="fiveInput wordleTile" disabled />
        <input id="i19" type="text" class="fiveInput wordleTile" disabled />
      </div>
      <div class="tile-section">
        <input id="i20" type="text" class="fiveInput wordleTile" disabled />
        <input id="i21" type="text" class="fiveInput wordleTile" disabled />
        <input id="i22" type="text" class="fiveInput wordleTile" disabled />
        <input id="i23" type="text" class="fiveInput wordleTile" disabled />
        <input id="i24" type="text" class="fiveInput wordleTile" disabled />
      </div>
      <div class="tile-section">
        <input id="i25" type="text" class="fiveInput wordleTile" disabled />
        <input id="i26" type="text" class="fiveInput wordleTile" disabled />
        <input id="i27" type="text" class="fiveInput wordleTile" disabled />
        <input id="i28" type="text" class="fiveInput wordleTile" disabled />
        <input id="i29" type="text" class="fiveInput wordleTile" disabled />
      </div>
    </React.Fragment>
  );
};

const SixLetters = () => {
  return (
    <React.Fragment>
      <div class="tile-section">
        <input id="i0" type="text" class="sixInput wordleTile" disabled />
        <input id="i1" type="text" class="sixInput wordleTile" disabled />
        <input id="i2" type="text" class="sixInput wordleTile" disabled />
        <input id="i3" type="text" class="sixInput wordleTile" disabled />
        <input id="i4" type="text" class="sixInput wordleTile" disabled />
        <input id="i5" type="text" class="sixInput wordleTile" disabled />
      </div>
      <div class="tile-section">
        <input id="i6" type="text" class="sixInput wordleTile" disabled />
        <input id="i7" type="text" class="sixInput wordleTile" disabled />
        <input id="i8" type="text" class="sixInput wordleTile" disabled />
        <input id="i9" type="text" class="sixInput wordleTile" disabled />
        <input id="i10" type="text" class="sixInput wordleTile" disabled />
        <input id="i11" type="text" class="sixInput wordleTile" disabled />
      </div>
      <div class="tile-section">
        <input id="i12" type="text" class="sixInput wordleTile" disabled />
        <input id="i13" type="text" class="sixInput wordleTile" disabled />
        <input id="i14" type="text" class="sixInput wordleTile" disabled />
        <input id="i15" type="text" class="sixInput wordleTile" disabled />
        <input id="i16" type="text" class="sixInput wordleTile" disabled />
        <input id="i17" type="text" class="sixInput wordleTile" disabled />
      </div>
      <div class="tile-section">
        <input id="i18" type="text" class="sixInput wordleTile" disabled />
        <input id="i19" type="text" class="sixInput wordleTile" disabled />
        <input id="i20" type="text" class="sixInput wordleTile" disabled />
        <input id="i21" type="text" class="sixInput wordleTile" disabled />
        <input id="i22" type="text" class="sixInput wordleTile" disabled />
        <input id="i23" type="text" class="sixInput wordleTile" disabled />
      </div>
      <div class="tile-section">
        <input id="i24" type="text" class="sixInput wordleTile" disabled />
        <input id="i25" type="text" class="sixInput wordleTile" disabled />
        <input id="i26" type="text" class="sixInput wordleTile" disabled />
        <input id="i27" type="text" class="sixInput wordleTile" disabled />
        <input id="i28" type="text" class="sixInput wordleTile" disabled />
        <input id="i29" type="text" class="sixInput wordleTile" disabled />
      </div>
      <div class="tile-section">
        <input id="i30" type="text" class="sixInput wordleTile" disabled />
        <input id="i31" type="text" class="sixInput wordleTile" disabled />
        <input id="i32" type="text" class="sixInput wordleTile" disabled />
        <input id="i33" type="text" class="sixInput wordleTile" disabled />
        <input id="i34" type="text" class="sixInput wordleTile" disabled />
        <input id="i35" type="text" class="sixInput wordleTile" disabled />
      </div>
    </React.Fragment>
  );
};

const Wordle = () => {
  const [letterCount, setLetterCount] = React.useState(null);
  const [letterChosen, setLetterChosen] = React.useState(false);
  const [currentWord, setCurrentWord] = React.useState(null);
  const [success, SetSuccess] = React.useState(null);
  const [tileIndex, setTileIndex] = React.useState(0);
  const [currentRow, setCurrentRow] = React.useState(1);
  // const [currentCorrect, setCurrentCorrect] = React.useState(0);
  const handleReset = () => {
    setLetterCount((p) => null);
    setLetterChosen((p) => false);
    setCurrentWord((p) => null);
    SetSuccess((p) => null);
    setTileIndex((p) => 0);
    setCurrentRow((p) => 1);
  };

  const handleFinished = (status) => {
    SetSuccess((p) => status);
  };

  const handleWordLength = (wordLength) => {
    setLetterCount((p) => wordLength);
    handleWord(wordLength);
    setLetterChosen((p) => true);
  };

  const handleWord = (wordLength) => {
    if (wordLength == 4) {
      const length = list4.length;
      const randomIndex = Math.floor(Math.random() * length);
      setCurrentWord((p) => list4[randomIndex].word.toUpperCase());
    } else if (wordLength == 5) {
      const length = list5.length;
      const randomIndex = Math.floor(Math.random() * length);
      setCurrentWord((p) => list5[randomIndex].word.toUpperCase());
    } else {
      const length = list6.length;
      const randomIndex = Math.floor(Math.random() * length);
      setCurrentWord((p) => list6[randomIndex].word.toUpperCase());
    }
  };

  const checkWord = () => {
    if (tileIndex == currentRow * letterCount) {
      // setCurrentCorrect((p) => 0);
      const currentCorrect = handleColors();
      if (currentCorrect == letterCount) {
        return handleFinished(true);
      }
      setCurrentRow((prevRow) => {
        const nextRow = prevRow + 1;
        if (nextRow == 7) {
          return handleFinished(false);
        }
        return nextRow;
      });
    }
  };

  const handleColors = () => {
    let count = 0;
    const NodeList = document.querySelectorAll("input");

    const matches = [].slice
      .call(NodeList)
      .slice((currentRow - 1) * letterCount, letterCount * currentRow);

    const wordSet = new Set();
    const wordObj = {};
    const yellowSet = new Set();
    for (let i = 0; i < currentWord.length; i++) {
      const letter = currentWord[i];
      if (!wordSet.has(letter)) {
        wordSet.add(letter);
        wordObj[letter] = new Set();
      }
      wordObj[letter].add(i);
    }

    for (let match of matches) {
      if (match.value === "") continue;
      const tileNumber = match.id.match(/\d+/)[0];
      const position = tileNumber % letterCount;
      const letter = match.value;
      if (letter in wordObj) {
        if (wordObj[letter].has(position)) {
          wordObj[letter].delete(position);
          document.querySelector(`#${match.id}`).classList.add("green");
          count++;
        } else {
          if (!yellowSet.has(letter)) {
            document.querySelector(`#${match.id}`).classList.add("yellow");
          }
          yellowSet.add(letter);
        }
        if (wordObj[letter].size === 0) delete wordObj[letter];
      } else {
        document.querySelector(`#${match.id}`).classList.add("gray");
      }
    }
    return count;
  };

  const addLetter = (e) => {
    const id = e.target.id;
    if (tileIndex >= letterCount * currentRow) return;
    const tile = document.querySelector(`#i${tileIndex}`);
    tile.value = id;
    setTileIndex((p) => {
      return p + 1;
    });
  };

  const removeLetter = () => {
    if (tileIndex - 1 < (currentRow - 1) * letterCount) return;
    setTileIndex((p) => {
      const tile = document.querySelector(`#i${p - 1}`);
      tile.value = "";
      return p - 1;
    });
  };
  if (success !== null) {
    return (
      <main className="wordle-container">
        <h1>{success ? "You Won!" : "You Lost!"}</h1>
        <h2>The word Was {currentWord}</h2>
        <button className="btn btn-outline-light" onClick={() => handleReset()}>
          Play Again!
        </button>
      </main>
    );
  }

  if (!letterChosen) {
    return (
      <main className="wordle-container">
        <h2 className="wordleMargin">How Many Letters for the Wordle?</h2>
        <div className="wordleLetterCount">
          <button
            class="btn btn-secondary "
            onClick={() => handleWordLength(4)}
          >
            4
          </button>
          <button class="btn btn-secondary" onClick={() => handleWordLength(5)}>
            5
          </button>
          <button class="btn btn-secondary" onClick={() => handleWordLength(6)}>
            6
          </button>
        </div>
      </main>
    );
  }

  return (
    <main className="wordle-container">
      <h1>Wordle</h1>
      <div class="tile-container">
        {letterCount == 4 ? (
          <FourLetters />
        ) : letterCount == 5 ? (
          <FiveLetters />
        ) : (
          <SixLetters />
        )}
      </div>
      <Keyboard
        addLetter={addLetter}
        removeLetter={removeLetter}
        checkWord={checkWord}
      />
    </main>
  );
};

export default Wordle;
